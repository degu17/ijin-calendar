# 偉人日めくりカレンダーアプリ 実装計画書

## 概要

本ドキュメントは「偉人日めくりカレンダーアプリ 要件定義書」に基づき、具体的な実装ステップを定義するものです。開発は複数のフェーズに分割し、段階的に機能を追加していくアプローチを採用します。

## 開発方針

- **段階的リリース**: MVP（Minimum Viable Product）を最優先で開発し、その後、機能拡張と品質向上を進めます。
- **バージョン管理**: `Git` を使用し、フィーチャーブランチモデルで開発を進めます。
- **コード品質**: `ESLint` と `Prettier` を導入し、一貫性のあるコードスタイルを維持します。
- **技術選定に関する注記**: 要件定義書で指定された一部ライブラリのバージョン（例: Next.js 15.4）は、現時点でリリースされていない未来のバージョンです。そのため、開発は指定されたバージョンコンセプトに沿いつつ、**現時点で利用可能な最新の安定版**を使用して進めます。これは、プロジェクトの安定性とセキュリティを確保するためです。

---

## フェーズ 0: プロジェクト基盤構築

開発を開始するための土台を構築します。

1.  **Next.jsプロジェクト作成**
    - `create-next-app` を使用し、以下の構成でプロジェクトを初期化します。
      - TypeScript
      - Tailwind CSS
      - ESLint
      - App Router
      - `src` ディレクトリ
2.  **依存関係のインストール**
    - `npm` を使用し、以下の主要ライブラリをインストールします。
      - `next-auth`
      - `@prisma/client`
      - `bcryptjs`
      - `zod`
      - その他、開発に必要なライブラリ
3.  **ディレクトリ構成の整備**
    - 要件定義書 `6.1` に基づき、以下のディレクトリ構造を作成・整備します。
      - `src/app`, `src/components`, `src/lib`, `src/data`, `src/types`, `public/images/great-people`
4.  **バージョン管理の開始**
    - `git init` を実行し、Gitリポジトリを初期化します。
    - `.gitignore` ファイルを適切に設定します。
    - `main` ブランチを作成し、最初のコミットを行います。

---

## フェーズ 1: MVP（最小実行可能製品）開発

アプリケーションの核となる基本機能を実装します。

1.  **データベース設定 (PostgreSQL + Prisma)**
    - Docker を使用して開発用の PostgreSQL 環境を構築します。（`docker-compose.yml`）
    - `.env` ファイルにデータベース接続情報（`DATABASE_URL`）を設定します。
    - `prisma/schema.prisma` ファイルに、要件定義書 `4.1` のスキーマ（`User`, `Account`など）を定義します。
    - `prisma migrate dev` を実行し、データベースにテーブルを作成します。
2.  **静的データと型定義の準備**
    - `src/data/great-people.json` に、サンプルを含む偉人データ（100人分）を配置します。
    - `public/images/great-people/` に、偉人の画像とプレースホルダー画像を配置します。
    - `src/types/index.ts` に、`GreatPerson` などの型定義を記述します。
3.  **認証システム構築 (NextAuth.js)**
    - `src/lib/auth.ts` に `authOptions` を設定します。
      - Google OAuth プロバイダと Credentials プロバイダを構成します。
      - `PrismaAdapter` を使用してデータベースと連携させます。
    - `/api/auth/[...nextauth]/route.ts` を作成します。
    - 認証関連のUIコンポーネント（ログインフォーム、Googleログインボタン）を `src/components/features/auth` に作成します。
    - `/auth/signin` などの認証ページを `src/app/(auth)` に作成します。
    - `middleware.ts` を作成し、ダッシュボードページへのアクセスを認証済みユーザーのみに制限します。
4.  **UIとスタイリング (Tailwind CSS)**
    - `src/app/layout.tsx` で全体的なレイアウトを定義します。
    - `src/globals.css` で基本的なスタイルとTailwindの設定を記述します。
    - 要件定義書 `19.1` を参考に、日めくりカレンダーのカードコンポーネント (`src/components/features/calendar/GreatPersonCard.tsx`) を作成します。
5.  **日めくりカレンダー機能の実装**
    - ログイン後のメインページ (`src/app/dashboard/page.tsx`) を作成します。
    - 要件定義書 `16.1` のアルゴリズムに基づき、その日の偉人を選出するロジック (`src/lib/great-person-service.ts` など) を実装します。
    - サーバーコンポーネント内でユーザーセッションと偉人データを取得し、クライアントコンポーネントに渡して表示します。
6.  **進捗管理機能の実装**
    - ユーザーが偉人を閲覧したことを記録するロジックを実装します。
    - 「閲覧済み」と判定する条件（例：5秒以上表示）を実装します。
    - `prisma.user.update` を使用して、`viewedGreatPeople` 配列と `currentProgress` を更新するAPIを作成します。
    - UIに進捗（例: `42人 / 100人`）を表示します。

---

## フェーズ 2: 機能拡張と品質向上

アプリケーションをより洗練させ、ユーザー体験を向上させます。

1.  **履歴機能の実装**
    - 閲覧済みの偉人一覧を表示するページ (`/dashboard/history`) を作成します。
    - データベースから `viewedGreatPeople` のリストを取得し、表示します。
2.  **デモモードの実装**
    - ログイン不要でアプリを体験できる `/demo` ルートを作成します。
    - 要件定義書 `20.1` に記載されている固定のデモデータを使用します。
    - デモモード専用のUIコンポーネントを作成し、会員登録への誘導（CTA）を配置します。
3.  **セキュリティ強化**
    - `lib/sanitize.ts` などを作成し、XSS対策を徹底します。
    - APIエンドポイントにレート制限を導入します。
    - `zod` を用いた環境変数の検証を実装します。
4.  **テストとデプロイ準備**
    - `Jest` と `React Testing Library` を導入し、主要なコンポーネントと関数の単体テストを作成します。
    - 本番環境用の `Dockerfile` を作成します。
    - `cloud-run.yaml` を作成し、Cloud Runへのデプロイ設定を記述します。
    - GitHub Actions を用いたCI/CDパイプラインの構築を検討します。

---

## スケジュール（目安）

- **フェーズ 0**: 1日
- **フェーズ 1**: 5-7日
- **フェーズ 2**: 3-5日

**合計: 約2週間**

*上記はあくまで目安であり、実装の難易度や予期せぬ問題によって変動する可能性があります。* 